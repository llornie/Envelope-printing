<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IMF Church Envelope</title>
  
  <!-- ADD THESE 3 LINES TO KILL CACHING FOREVER -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <style>
    @page { size: 9.5in 4.125in; margin: 0; }
    html, body {
      width: 9.5in; height: 4.125in; margin: 0; padding: 0;
      background: #fff; font-family: Arial, Helvetica, sans-serif;
      -webkit-print-color-adjust: exact; print-color-adjust: exact;
    }
    .envelope { position: relative; width: 9.5in; height: 4.125in; overflow: hidden; }

    #return-address {
      position: absolute;
      top: 0.4in;
      left: 0.6in;
      font-size: 11pt;
      line-height: 1.35;
      color: #000;
    }

    #addr {
      position: absolute;
      top: 1.5in;
      left: 3.6in;
      width: 5.2in;
      font-size: 16pt;
      font-weight: normal;
      line-height: 1.45;
      white-space: pre-line;
    }

    .debug #return-address, .debug #addr { outline: 1px dashed #c00; }
  </style>
</head>
<body>
  <div class="envelope">

    <!-- RETURN ADDRESS -->
    <div id="return-address">
      IMF Church<br>
      Box 973<br>
      Arborg MB R0C 0A0
    </div>

    <!-- RECIPIENT ADDRESS -->
    <div id="addr"></div>

  </div>

  <script>
    const qs = new URLSearchParams(location.search);
    const get = (k, f = "") => qs.get(k) ?? f;

    // Build recipient address
    let payee = get("payee", "").trim();
    let line2 = get("line2", "").trim();
    let line3 = get("line3", "").trim();
    const combo = get("address", "").trim();

    if (!line2 && !line3 && combo) {
      const words = combo.trim().split(/\s+/);
      line2 = words.slice(0, 2).join(" ");
      line3 = words.slice(2).join(" ");
    }

    const lines = [];
    if (payee) lines.push(payee);
    if (line2 || line3) lines.push([line2, line3].filter(Boolean).join(" "));
    document.getElementById("addr").textContent = lines.join("\n");

    // Debug mode
    if (get("debug") === "1") document.body.classList.add("debug");

    // Auto-print (disable with &autoprint=0)
    if (get("autoprint", "1") !== "0") window.addEventListener("load", () => window.print());
  </script>
</body>
</html>
