<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IMF Church #10 Envelope</title>
  <style>
    @page { size: 9.5in 4.125in; margin: 0; }
    html, body {
      width: 9.5in; height: 4.125in; margin: 0; padding: 0; background: #fff;
      -webkit-print-color-adjust: exact; print-color-adjust: exact;
      font-family: Arial, sans-serif;
    }
    .envelope { position: relative; width: 9.5in; height: 4.125in; overflow: hidden; }

    /* RETURN ADDRESS – true top-left corner */
    #return-address {
      position: absolute;
      top: 0.35in;
      left: 0.6in;
      font-size: 11pt;
      line-height: 1.3;
    }
    #logo {
      position: absolute;
      top: 0.25in;
      left: 0.35in;
      height: 0.9in;
      width: auto;
    }

    /* RECIPIENT ADDRESS – center/right */
    #addr {
      position: absolute;
      top: 1.6in;
      left: 3.7in;
      width: 5in;
      font-size: 16pt;
      font-weight: bold;
      line-height: 1.45;
      white-space: pre-line;   /* respects real line breaks, hides \n */
    }

    /* Debug mode: ?debug=1 */
    .debug #return-address, .debug #logo, .debug #addr { outline: 1px dashed red; }
  </style>
</head>
<body>
  <div class="envelope">
    <!-- RETURN ADDRESS (top-left corner) -->
    <div id="return-address">
      IMF Church<br>
      Box 973<br>
      Arborg MB R0C 0A0
    </div>

    <!-- LOGO (top-left corner) -->
    <img id="logo" src="logo_imf.png?v=5" alt="IMF Church">

    <!-- RECIPIENT ADDRESS (center/right) -->
    <div id="addr"></div>
  </div>

  <script>
    const qs = new URLSearchParams(location.search);
    const get = (k, f = "") => qs.get(k) ?? f;
    const getNum = (k, f) => parseFloat(qs.get(k)) || f;

    // Optional fine-tuning via URL
    const debug = get("debug") === "1";
    if (debug) document.body.classList.add("debug");

    // Recipient address lines
    let payee = get("payee", "").trim();
    let line2 = get("line2", "").trim();
    let line3 = get("line3", "").trim();
    const combo = get("address", "").trim();

    if (!line2 && !line3 && combo) {
      const words = combo.trim().split(/\s+/);
      line2 = words.slice(0, 2).join(" ");      // e.g. "Box 973" or "123 Main"
      line3 = words.slice(2).join(" ");        // city + province + postal
    }

    // Build clean address (payee on its own line, then street + city)
    const lines = [];
    if (payee) lines.push(payee);
    if (line2 || line3) lines.push([line2, line3].filter(Boolean).join(" "));
    document.getElementById("addr").textContent = lines.join("\n");

    // Auto-print
    if (get("autoprint", "1") !== "0") window.print();
  </script>
</body>
</html>
